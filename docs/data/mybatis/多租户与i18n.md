# å¤šç§Ÿæˆ·ä¸i18n
å¤šç§Ÿæˆ·æŠ€æœ¯æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æŠ€æœ¯ï¼Œå¯å®ç°ç”¨ä¸€å¥—åº”ç”¨ç¨‹åºï¼Œä¸ºå¤šä¸ªä¼ä¸šç”¨æˆ·æä¾›SaaSæœåŠ¡å¹¶ç¡®ä¿æ•°æ®çš„<font color=red>å®Œå…¨éš”ç¦»æ€§</font>ã€‚

i18næ˜¯æŒ‡åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥å¤šç§ä¸åŒè¯­è¨€ä¸ºç”¨æˆ·æä¾›æœåŠ¡çš„èƒ½åŠ›ï¼ˆå›½é™…åŒ–ï¼‰ï¼ŒåŒ…æ‹¬ï¼šæ—¶åŒºã€è´§å¸ç­‰è½¬æ¢ã€‚

## å¤šç§Ÿæˆ·
### å¤šç§Ÿæˆ·å®ç°æ–¹æ¡ˆ
**SQLå¤šç§Ÿæˆ·ï¼š**

|æ•°æ®åº“çº§åˆ«	|éš”ç¦»æ–¹å¼										|æ¨èå®ç°æ–¹å¼									|éš”ç¦»å®‰å…¨çº§åˆ«		|ç»´æŠ¤æˆæœ¬			|
|--			|--												|--											|--				|--					|
|è¡Œçº§		|è¡¨ä¸­`tenant_xx`ç§Ÿæˆ·å­—æ®µéš”ç¦»ï¼Œæ“ä½œæ—¶è¿›è¡Œåˆ¤æ–­åŒºåˆ†	|CRMæ¡†æ¶æä¾›SQLæ”¹å†™ï¼Œæ“ä½œæ—¶è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·æ¡ä»¶		|ä½				|ä½					|
|è¡¨çº§		|è¡¨ä¸­`tenant_xx`ç§Ÿæˆ·å­—æ®µéš”ç¦»ï¼Œå°†ä¸åŒç§Ÿæˆ·åˆ†è¡¨å­˜å‚¨	|ShardingJDBCåˆ†è¡¨ï¼Œæ“ä½œæ—¶è‡ªåŠ¨æ”¹å†™SQLè·¯ç”±		|ä¸€èˆ¬			|ä¸€èˆ¬				|
|åº“çº§		|æ•°æ®æºä¸­ç§Ÿæˆ·é…ç½®éš”ç¦»ï¼Œç‹¬ç«‹æ•°æ®åº“					|ä½¿ç”¨åŠ¨æ€æ•°æ®æºï¼Œæ¨èå°†æ•°æ®åº“é…ç½®ä¿¡æ¯å­˜å…¥é…ç½®è¡¨	|é«˜				|é«˜					|
|å®ä¾‹çº§		|æ•°æ®æºä¸­ç§Ÿæˆ·é…ç½®éš”ç¦»ï¼Œç‹¬ç«‹å®ä¾‹						|ä½¿ç”¨åŠ¨æ€æ•°æ®æºï¼Œæ¨èå°†æ•°æ®åº“é…ç½®ä¿¡æ¯å­˜å…¥é…ç½®è¡¨	|è¶…é«˜			|æ¨èä»¥ç§æœ‰äº‘ä»£æ›¿		|

**NoSQLå¤šç§Ÿæˆ·ï¼š**

|NoSQLæ•°æ®åº“		|è¡Œçº§		|è¡¨çº§		|åº“çº§							|å®ä¾‹çº§								|
|--				|--			|--			|--								|--									|
|Redis			|æ— éœ€å¤„ç†	|æ— éœ€å¤„ç†	|åŠ¨æ€æ•°æ®æºï¼ŒdbåŒºåˆ†				|åŠ¨æ€æ•°æ®æºï¼Œç‹¬ç«‹å®ä¾‹åŒºåˆ†			|
|ClickHouse		|æ— éœ€å¤„ç†	|æ— éœ€å¤„ç†	|åŠ¨æ€æ•°æ®æºï¼ŒdbåŒºåˆ†				|åŠ¨æ€æ•°æ®æºï¼Œç‹¬ç«‹å®ä¾‹åŒºåˆ†			|
|Elasticsearch	|æ— éœ€å¤„ç†	|æ— éœ€å¤„ç†	|åŠ¨æ€æ•°æ®æºï¼Œç‹¬ç«‹å®ä¾‹åŒºåˆ†			|åŠ¨æ€æ•°æ®æºï¼Œç‹¬ç«‹å®ä¾‹åŒºåˆ†			|
|OSS			|æ— éœ€å¤„ç†	|æ— éœ€å¤„ç†	|åŠ¨æ€æ•°æ®æºï¼Œå­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰	|åŠ¨æ€æ•°æ®æºï¼Œè®¿é—®åŸŸåï¼ˆEndpointï¼‰	|

**å¤šçº§ç§Ÿæˆ·åŒºåˆ†ï¼š**

|ç§Ÿæˆ·ç±»å‹					|ä½œç”¨èŒƒå›´										|è§£é‡Š										|
|--							|--												|--											|
|ç³»ç»Ÿç§Ÿæˆ·ï¼ˆ`tenant_sys`ï¼‰		|ä»…é€‚ç”¨äºä¸­å°æ¨¡å¼ï¼Œä¸­å°éœ€å¯¹ä¸šåŠ¡ç³»ç»Ÿæä¾›ç§Ÿæˆ·åŒºåˆ†		|å¦‚ï¼šä¸­å°éœ€å¯¹é˜¿é‡Œäº‘ã€æ·˜å®ã€èœé¸Ÿç‰©æµçš„æ•°æ®è¿›è¡ŒåŒºåˆ†	|
|ä¼ä¸šç§Ÿæˆ·ï¼ˆ`tenant_co`ï¼‰	    |ä»…é€‚ç”¨äºSaaSæœåŠ¡æ¨¡å¼ä¸‹ï¼Œå¯¹ä¼ä¸šç§Ÿæˆ·è¿›è¡Œéš”ç¦»åŒºåˆ†		|å¦‚ï¼šé˜¿é‡Œäº‘éœ€å¯¹ä¼ä¸šç§Ÿæˆ·è¿›è¡Œéš”ç¦»åŒºåˆ†				|

> `tenant_sys`ä¸`tenant_co`å­—æ®µï¼Œå¯æ ¹æ®éœ€æ±‚é€‰æ‹©å…¨è¡¨è§„èŒƒæˆ–éƒ¨åˆ†è¡¨ä½¿ç”¨
> - é‡‡ç”¨å…¨è¡¨è§„èŒƒå¯ä½¿ç”¨`TenantLineInnerInterceptor`è¡Œçº§ç§Ÿæˆ·æ‹¦æˆªå™¨è¿›è¡Œå…¨å±€SQLæ”¹å†™ï¼Œè¿½åŠ ç§Ÿæˆ·æŸ¥è¯¢æ¡ä»¶
> - é‡‡ç”¨éƒ¨åˆ†è¡¨ä½¿ç”¨ï¼Œæ–°å¢æ•°æ®è‡ªåŠ¨å¡«å……å¯é‡‡ç”¨å®¡è®¡å®ç°ï¼ŒæŸ¥è¯¢æ¡ä»¶è¿½åŠ éœ€è‡ªè¡Œç»´æŠ¤
> - `tenant_sys`å­—æ®µæ›´å¤šç”¨äºä¸šåŠ¡åˆ¤æ–­ï¼ŒåŒºåˆ†é€»è¾‘å®ç°ï¼ˆä¸€èˆ¬ç³»ç»Ÿç§Ÿæˆ·åœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼‰

### å¤šç§Ÿæˆ·å®ç°-è¡Œçº§
```java
@Bean
public MybatisPlusInterceptor mybatisPlusInterceptor() {
    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
    interceptor.addInnerInterceptor(new TenantLineInnerInterceptor(new TenantLineHandler() {
        @Override
        public String getTenantIdColumn() {
            return "tenant_sys";
        }

        @Override
        public Expression getTenantId() {
            return new StringValue(ServletUtils.getRequest().getHeader(DataFillProvider.tenantSysField));
        }
    }));

    return interceptor;
}
```

### å¤šç§Ÿæˆ·å®ç°-è¡¨çº§

### å¤šç§Ÿæˆ·å®ç°-åº“çº§/å®ä¾‹çº§
åŠ¨æ€æ•°æ®æº...

## i18n
[ğŸ‘‰i18nåŸºç¡€æ”¯æŒè§baseæ¨¡å—](base/i18n.md)

### i18nè§„èŒƒ
1. å‚æ•°å®šä¹‰ï¼š

|å‚æ•°åç§°			|å‚æ•°ç±»å‹	|æœ€å¤§é•¿åº¦	|æè¿°									|ç¤ºä¾‹								|
|--					|--			|--			|--										|--									|
|`tenantSys`		|String		|36			|ç³»ç»Ÿç§Ÿæˆ·ï¼šä¸€çº§ç§Ÿæˆ·ï¼ˆdict_tenant_sysï¼‰    	|sc									|
|`tenantCo`			|String		|36			|ä¼ä¸šç§Ÿæˆ·ï¼šäºŒçº§ç§Ÿæˆ·						|27b106951b964851b73e5d2864e9257b	|
|`Accept-Language`	|String		|20			|i18nå›½é™…åŒ–-è¯­è¨€åˆ‡æ¢					    |zh-CN								|

2. å…¨å±€å›´ç»•`LocaleContextHolder`å®ç°åŠ¨æ€è¯­è¨€ä¸æ—¶åŒºç­‰è½¬æ¢ã€‚
3. åŠ¨æ€æ—¶åŒºè®¾ç½®
  - ä¸ºè§„é¿æ—¶åŒºæ³¨å…¥é£é™©ï¼Œå®‰å…¨èµ·è§åŠ¨æ€æ—¶åŒºç”±å¼€å‘è€…åœ¨æ‹¦æˆªå™¨ä¸­ï¼Œæ ¹æ®ç§Ÿæˆ·IDä¸è¯­è¨€è¿›è¡ŒåŒ¹é…è®¾ç½®å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡çš„æ—¶åŒº
  - è¯·æ±‚ä¸Šä¸‹æ–‡çš„æ—¶åŒºè®¾ç½®ä»£ç `LocaleContextHolder.setTimeZone(TimeZone.getTimeZone(timeZone))`

### i18n yue-libraryå®ç°
- mybatisæ¡†æ¶ä¸­çš„æ—¶é—´å¡«å……çš†æä¾›i18nè§„èŒƒæ”¯æŒï¼Œå³ï¼š`LocalDateTime.now(LocaleContextHolder.getTimeZone().toZoneId())`ã€‚
- é€»è¾‘åˆ é™¤æš‚ä¸æ”¯æŒi18næ—¶é—´æˆ³ï¼Œå› ä¸ºæ­¤éœ€æ±‚ä¼˜å…ˆçº§ä¸é«˜ï¼Œå¹¶ä¸”å¯ä»¥é‡‡ç”¨æ›´æ–°æ—¶é—´ä½œä¸ºå¯è§†åŒ–è§‚å¯Ÿå€¼

### i18n å¼€å‘è€…å®ç°
å‚è€ƒç¤ºä¾‹ï¼š
```java
@Slf4j
public class HttpRequestInterceptor implements HandlerInterceptor {

	/**
	 * åœ¨æ§åˆ¶å™¨ï¼ˆcontrolleræ–¹æ³•ï¼‰æ‰§è¡Œä¹‹å‰
	 */
	@Override
	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
		// 1. è·å–requestæ¥å£ä¿¡æ¯
		String requestIp = ServletUtils.getClientIP(request);
		String requestUri = request.getMethod() + " " + request.getRequestURI();
		String acceptLanguage = request.getHeader("Accept-Language");
		String tenantSys = request.getHeader("tenantSys");

		// 2. è·å–controlleræ–¹æ³•ä¿¡æ¯
		String requestHandlerMethod = "";
		if (handler instanceof HandlerMethod) {
			Method method = ((HandlerMethod) handler).getMethod();
			requestHandlerMethod = method.getDeclaringClass().getName() + "." + method.getName() + "()";
		}

		// 3. æ‰“å°æ—¥å¿—
		log.info("acceptLanguage={}", acceptLanguage);
		log.info("tenantSys={}", tenantSys);
		log.info("requestIp={}", requestIp);
		log.info("requestUri={}", requestUri);
		log.info("requestHandlerMethod={}", requestHandlerMethod);

		// 4. i18nå¤„ç†
		if (StrUtil.isNotBlank(tenantSys)) {
			switch (tenantSys) {
                case "china":
                	LocaleContextHolder.setTimeZone(TimeZone.getTimeZone("Asia/Tokyo"));
					break;
				case "japan":
					LocaleContextHolder.setTimeZone(TimeZone.getTimeZone("Asia/Tokyo"));
					break;
				default:
					log.warn("ã€æ—¶åŒºã€‘å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­ï¼Œæœªèƒ½æ­£ç¡®é…ç½®æ—¶åŒºï¼Œå°†é‡‡ç”¨ç³»ç»Ÿï¼ˆå®¹å™¨ï¼‰çš„é»˜è®¤æ—¶åŒºï¼ŒtenantSys={}", tenantSys);
			}
		} else {
			log.warn("ã€æ—¶åŒºã€‘å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­ï¼Œæœªèƒ½æ­£ç¡®é…ç½®æ—¶åŒºï¼Œå°†é‡‡ç”¨ç³»ç»Ÿï¼ˆå®¹å™¨ï¼‰çš„é»˜è®¤æ—¶åŒºï¼ŒtenantSys=null");
		}

		// 5. æ‰§è¡Œåç»­é€»è¾‘
		return HandlerInterceptor.super.preHandle(request, response, handler);
	}

}
```

## å¤šç§Ÿæˆ·ä¸i18n
ç§Ÿæˆ·ä¸i18nå…³è”ï¼Œå®ç°SaaSå›½é™…åŒ–
